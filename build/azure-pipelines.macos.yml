trigger:
  branches:
    include:
      - "*"
  paths:
    include:
      - "*"
    exclude:
      - "**/*.md"
pr:
  # branches:
    include:
      - "*"
pool:
  name: "Hosted macOS High Sierra"
steps:
  - bash: SYMLINK=5_4_1 && MONOPREFIX=/Library/Frameworks/Mono.framework/Versions/$SYMLINK && echo "##vso[task.setvariable variable=DYLD_FALLBACK_LIBRARY_PATH;]$MONOPREFIX/lib:/lib:/usr/lib:$DYLD_LIBRARY_FALLBACK_PATH" && echo "##vso[task.setvariable variable=PKG_CONFIG_PATH;]$MONOPREFIX/lib/pkgconfig:$MONOPREFIX/share/pkgconfig:$PKG_CONFIG_PATH" && echo "##vso[task.setvariable variable=PATH;]$MONOPREFIX/bin:$PATH"
    displayName: "Set Mono Version"

  - task: UseDotNet@2
    displayName: "Install .net core 2.1"
    inputs:
      packageType: sdk
      version: "2.1.802"
      installationPath: $(Agent.ToolsDirectory)/dotnet

  - task: UseDotNet@2
    displayName: "Install .net core 2.2"
    inputs:
      packageType: sdk
      version: "2.2.402"
      installationPath: $(Agent.ToolsDirectory)/dotnet

  - task: UseDotNet@2
    displayName: "Install .net core 3.0"
    inputs:
      packageType: sdk
      version: "3.0.100"
      installationPath: $(Agent.ToolsDirectory)/dotnet

  - task: Bash@3
    displayName: "Compile & Tests"
    inputs:
      targetType: filePath
      filePath: ./build.sh

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: "VSTest"
      testResultsFiles: "**/*.trx"
      testRunTitle: "LocalStack.Client.Tests"

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: "VSTest"
      testResultsFiles: "**/*.trx"
      testRunTitle: "LocalStack.Client.Integration.Tests"
